<model name="mappingtransfo" title="Mapping" layout="flat">
     <desc>
Please enter the mapping options, if any, for the different coupling fields,
selecting the different rows available.
The "load" button is useless for the OASIS3-MCT application.[]
A blue (?), located at the right bottom of this window, gives more information on the data to fill up.
     </desc>
</model>
 <model name="transfmap" title="Mapping remapping" layout="flat">
    <multiple name="map" title="Mapping options" require="field_names_list" custom_label="Fields">
         <xor name="mapremapping" title="Mapping" default="mapping_off">
	   <model name="mapping_off" title="NO MAPPING">
	   </model>
	   <model name="mapping_on" title="MAPPING">
	     <param name="filename" title="Remapping file (NetCDF)" type="string"/>
	     <choice name="maploc" title="Where to do the mapping" type="string" default="src">
	       <option value="src" title="Source processors (src)"/>
               <option value="dst" title="Target processors (dst)"/>
	     </choice>
	     <choice name="mapstrategy" title="Mapping strategy" type="string" default="bfb">
	       <option value="bfb" title="Bit-for-bit reproductibility (bfb)"/>
               <option value="sum" title="Partial sum (sum)"/>
               <option value="opt" title="Optimized (opt)"/>
	     </choice>
           </model>
	 </xor>
       </multiple>
    <docu> 
[section=Mapping]
The MAPPING option is used to specify an input file to be read and used for mapping (ie. regridding or interpolation). 
This is an alternative method to the SCRIP library for setting the mapping file.


Since OASIS3-MCT_2.0, MAPPING can be used for higher order remapping. Up to 5 different sets of weights can be applied 
to up to 5 different fields transfered as oasis_put arguments. []

Some details on the MAPING opton are available in the User Guide section 4.3 and 5.4.

<docuold>
[section=Mapping file]
The mapping file to read is a NetCDF file consistent with the SCRIPR map file format, see the Figure 1 below: []

[image=fig_mapping_file_1.gif;caption=Figure 1: Header of the remapping file] []
    
- src_grid_size is a scalar integer indicating the total number of points in the source grid. This is 
typically a large number. This field is a netCDF dimension. []
- dst_grid_size is a scalar integer indicating the total number of points in the target grid. This is 
typically a large number. This field is a netCDF dimension. []
- num_links is a scalar integer indicating the total number of associated grid point pairs in the file. 
This is typically a large number. This field is a netCDF dimension. []
- num_wgts is a scalar integer indicating the number of weights per associated grid point pair 
(up to 5 are supported). This field is a netCDF dimension. []
- src_address is a one dimensional array of size num_links. It contains the integer source address 
associated with each weight. This field is a netCDF variable. []
- dst_address is a one dimensional array of size num_links. It contains the integer destination address 
associated with each weight. This field is a netCDF variable. []
- remap_matrix is a two dimensional array of size (num_links, num_wgts). It contains the real weight value(s) 
associated with the source and destination address. This field is a netCDF variable. []

    
[section=Mapping options]
The remapping can done either on the source or the target processors (Mapping location). 
With the option "source processors" (src), the mapping will be done in parallel on the source processors before 
communication to the destination model processes; this is the default. With he option "target processors" (dst), 
the mapping is done on the destination processes after the source grid data is sent from the source model. []

The remapping strategy can be either "Bit-for-bit reproductibility" (bfb), "Partial sum" (sum), 
or "Optimized" (opt). []
In bfb mode, the mapping is done using a strategy that produces bit-for-bit identical results regardless of the 
grid decompositions without leveraging a partial sum computation; this is the default. With sum, the transform 
is done using the partial sum approach which generally introduces roundoff level changes in the results on 
different processor counts. Option opt allows the coupling layer to choose either approach based on an analysis 
of which strategy is likely to run faster. Usually, partial sums will be used if the source grid has a higher 
resolution than the target grid as this should reduce the overall communication (e.g. for conservative remapping). []

Note that if the SCRIP library is used to calculate the remapping file, MAPPING can still be used to 
specify a name for the remapping file generated by SCRIP different from the default and/or to specify a 
remapping location or a remappin strategy option. 
</docuold>
  </docu>
</model>








